I'm sorry to hear that it's still not working. Let's try a more simplified approach to ensure we can pinpoint the issue. I'll provide a minimal example that focuses solely on reading the CSV file and displaying it in a table. Once we confirm this works, we can add the additional functionality.

Here's the simplified code:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stocktake Buddy</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            background-color: #1c1c1c;
        }
        h1 {
            color: white;
            text-align: center;
            margin-top: 20px;
        }
        .button {
            margin: 20px;
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background-color: #a89a68;
            border: none;
            cursor: pointer;
        }
        table {
            width: 90%;
            max-width: 800px;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #a89a68;
            color: #1c1c1c;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <h1>Stocktake Buddy</h1>
    <input type="file" id="fileInput" accept=".xlsx, .xls" onchange="handleFile(event)">
    <table id="dataGrid">
        <thead>
            <tr id="headerRow"></tr>
        </thead>
        <tbody id="dataBody"></tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        function handleFile(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                console.log('JSON Data:', jsonData); // Debugging line
                populateTable(jsonData);
            };
            reader.readAsArrayBuffer(file);
        }

        function populateTable(data) {
            const headerRow = document.getElementById('headerRow');
            const dataBody = document.getElementById('dataBody');
            headerRow.innerHTML = '';
            dataBody.innerHTML = '';

            if (data.length === 0) {
                console.error('No data found in the uploaded file.');
                return;
            }

            // Create header row
            data[0].forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            // Create data rows
            data.slice(1).forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                dataBody.appendChild(tr);
            });
            console.log('Table populated'); // Debugging line
        }
    </script>
</body>
</html>
```

Please try this simplified version and let me know if the table populates correctly when you upload a CSV file. If it works, we can then proceed to add the additional functionality. If it still doesn't work, please check the browser console for any errors and share them with me.
